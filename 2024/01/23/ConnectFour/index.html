<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo.png"/>
	<link rel="shortcut icon" href="/img/logo.png">
	
			    <title>
    Kevin's blog
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="Kevin's blog" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<meta name="generator" content="Hexo 5.4.2"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">KEVIN</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li><li><a class="category-link" href="/categories/%E8%AE%BA%E6%96%87%E9%9A%8F%E7%AC%94/">论文随笔</a></li><li><a class="category-link" href="/categories/%E8%AF%BE%E7%A8%8B%E6%8A%A5%E5%91%8A/">课程报告</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        
		        <li>
		            <a href="/homepage/" title="学术主页">
		                学术主页
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Kevin-thu" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="twitter" href="https://twitter.com/sze68zkw" target="_blank" rel="noopener">
                            <i class="icon fa fa-twitter"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(https://www.slideteam.net/media/catalog/product/cache/1280x720/i/n/introduction_to_artificial_intelligence_powerpoint_presentation__Slide01.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >IAI Lab3 Connect Four Report</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h1 id="IAI实验三报告：重力四子棋"><a href="#IAI实验三报告：重力四子棋" class="headerlink" title="IAI实验三报告：重力四子棋"></a>IAI实验三报告：重力四子棋</h1><blockquote>
<p>张凯文 计12 2021010729</p>
</blockquote>
<h1 id="算法思路"><a href="#算法思路" class="headerlink" title="算法思路"></a>算法思路</h1><p>本次实验我主要使用了 UCT 信心上限树算法（蒙特卡洛树搜索 + UCB 估值）。树搜索的过程主要分为以下四步：选举、扩展、随机模拟、反向传播。具体来说，这四个步骤分别表示：</p>
<ul>
<li><p><strong>选举(selection)</strong> 是根据当前获得所有子节点的统计结果，选择一个最优的子节点。在 UCT 算法中，选择最优子节点的原则基于 UCB 信心上限估值，由下列公式给出对当前各个子节点价值置信区间的上限，以此平衡对已知结果的**利用(exploitation)<strong>和对未知结果的</strong>探索(exploration)**：</p>
<p>  $$<br>  v_i+c\sqrt{\cfrac{2\ln N}{\ln n_i}}<br>  $$</p>
<p>  其中 $v_i$ 是第 $i$ 个子节点的当前价值，$N$ 是当前节点的总探索次数，$n_i$ 是第 $i$ 个孩子的探索次数， $c$ 是可调节的参数， $c$ 越大将越倾向于“探索”。</p>
</li>
<li><p><strong>扩展(expansion)</strong> 是当我们搜到当前树的边界后，向外继续扩展子节点。</p>
</li>
<li><p><strong>随机模拟(simulation)</strong> 对新加入的子节点，通过随机模拟游戏直到决出胜负（或平局）来对节点当前价值进行评估。</p>
</li>
<li><p><strong>反向传播(Back-Propagation)</strong> 根据随机模拟的结果，更新当前节点及其所有父节点的探索总数和价值。</p>
</li>
</ul>
<p>算法的伪代码如下：</p>
<p><img src="https://img2.imgtp.com/2024/01/23/2Z9OhMm0.png" alt="Untitled"></p>
<h1 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h1><p>我在 <code>UCT.h</code> &#x2F; <code>UCT.cpp</code> 中实现了 <code>UCT</code> 类，按照上述伪代码给出的逻辑实现了：</p>
<ul>
<li><code>search</code>：搜索主函数，根据当前棋局进行 UCT 树搜索，在限定时间内给出当前搜索结果中的最优的下一步走棋位置；</li>
<li><code>treePolicy</code>：若当前节点可扩展，则调用 <code>expand</code> 扩展子节点；否则选出最优子节点直到能够扩展或终止节点；</li>
<li><code>defaultPolicy</code>：对当前节点随机模拟，返回收益；</li>
<li><code>getStatus</code>：获取当前节点状态（胜利、失败、平局或未完结）；</li>
<li><code>update</code>：根据走子的列和走子方更新棋盘。</li>
</ul>
<p>在 <code>State.h</code> &#x2F; <code>State.cpp</code> 中实现了状态节点类 <code>State</code>，包括下列方法：</p>
<ul>
<li><code>bestChild</code>：根据 UCB 估值给出当前节点的最优子节点；</li>
<li><code>expand</code>：扩展子节点；</li>
<li><code>terminate</code>：判定节点是否是终止节点；</li>
<li><code>action</code>：返回当前节点对应的走子位置；</li>
<li><code>mustPlay</code>：判定当前棋局是否有必胜&#x2F;必堵位置；</li>
<li><code>mustNotPlay</code>：判定给定走子位置是否是必不能下的位置（下了对方就赢了），详见下方优化尝试；</li>
<li><code>clearMustNotPlay</code>：一次性清除当前节点必不能下的位置（除非清楚后无路可走）。</li>
</ul>
<h1 id="优化与尝试"><a href="#优化与尝试" class="headerlink" title="优化与尝试"></a>优化与尝试</h1><h2 id="逻辑特判与剪枝"><a href="#逻辑特判与剪枝" class="headerlink" title="逻辑特判与剪枝"></a>逻辑特判与剪枝</h2><ul>
<li>若当前棋盘存在<strong>必胜</strong>位置（己方已连成三子）或<strong>必堵</strong>位置（对方已连成三子），那么不再搜索，直接在对应位置落子；</li>
<li>上述策略可以进一步应用到 <code>expand</code> 扩展子节点的剪枝中：若在扩展节点时发现存在必胜或必堵位置，则直接选择该子节点并清空其他选择；</li>
<li>在观察某些失败棋局时发现，AI 有时存在“送子”现象，即在某个位置落子后，对方紧接着在其落子位置上方落子即可取胜，若非万不得已，在这样的位置落子显然是“利人不利己”的，因此可以将这样的位置判定为“必不能下”的位置。在根节点处，一次性清除根节点必不能下的位置，即有可能剪掉大量不用搜索的分支。这一策略也可以进一步应用在搜索树的任一节点处，即在建立节点时就清掉这类“必不能下”的位置；但由于这种情况在总体模拟中出现可能性并不多，而每次判断本身会耗时，带来的总体收益也并不明显，甚至有所下滑。</li>
</ul>
<h2 id="性能提升"><a href="#性能提升" class="headerlink" title="性能提升"></a>性能提升</h2><p>在大量实验后发现，对 AI 实际胜率影响最大的还是搜索节点数，因此搜索效率的提升至关重要。对此，我也进行了一定优化：</p>
<ul>
<li>节点重复利用：开辟一块节点池，在第一次走子 <code>new</code> 申请完空间后暂不释放，在下一次走子时即可不用重新用 <code>new</code> 申请空间，可重复利用之前的空间更改参数即可，以此节省大量内存申请、释放所需的时间；</li>
<li>在 <code>UCT</code> 类中以静态变量统一存储 <code>board</code> 和 <code>top</code>，避免在每个状态节点中反复申请存储。</li>
</ul>
<h2 id="其他尝试"><a href="#其他尝试" class="headerlink" title="其他尝试"></a>其他尝试</h2><p>我也尝试对参数 $c$ 的选取策略进行优化。我们知道，$c$ 选的越大 AI 越倾向于探索未知区域，$c$ 选的越小 AI 越倾向于利用已经探索过的信息。考虑人类下棋时的一般规律，在开局时一般倾向于探索开辟局面，在后期一般倾向于利用信息，因此在选择节点时也可以利用类似策略，对 $c$ 采用指数或线性衰减策略，如： $c&#x3D;c_0 e^{\alpha t}$。但简单尝试后发现效果并不显著，甚至有所下滑，因为在开局时在相近位置堆叠形成优势也可能是重要的，因此最终放弃这一尝试，固定 $c &#x3D; 0.9$。（事实上，实验表明，保证搜索效率的情况下 UCT 搜索的结果已经表现非常非常好，而以我们的下棋水平，基于人类先验的许多“优化”很可能都是负优化）。</p>
<h1 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h1><p>在 saiblo 上与偶数编号 AI 的批量测试结果如下，仅在与 94 号 AI 的对决中小输一局：</p>
<p><img src="https://img2.imgtp.com/2024/01/23/NgN8EaVE.png" alt="Untitled"></p>
<p>并且我的 AI 发挥非常稳定，在与高水平测试 AI  的批量测试中胜率如下：</p>
<table>
<thead>
<tr>
<th>AI编号</th>
<th>总对局数</th>
<th>胜：负：平</th>
<th>总胜率</th>
<th>先手胜率</th>
<th>后手胜率</th>
</tr>
</thead>
<tbody><tr>
<td>92</td>
<td>20</td>
<td>20：0：0</td>
<td>100%</td>
<td>100%</td>
<td>100%</td>
</tr>
<tr>
<td>94</td>
<td>20</td>
<td>16：4：0</td>
<td>80%</td>
<td>70%</td>
<td>90%</td>
</tr>
<tr>
<td>96</td>
<td>20</td>
<td>17：3：0</td>
<td>85%</td>
<td>90%</td>
<td>80%</td>
</tr>
<tr>
<td>98</td>
<td>20</td>
<td>18：2：0</td>
<td>90%</td>
<td>90%</td>
<td>90%</td>
</tr>
<tr>
<td>100</td>
<td>20</td>
<td>16：4：0</td>
<td>80%</td>
<td>90%</td>
<td>70%</td>
</tr>
</tbody></table>
<p>下面是这两次批量测试的截图：</p>
<p><img src="https://img2.imgtp.com/2024/01/23/9UOCk1p0.png" alt="Untitled"></p>
<p><img src="https://img2.imgtp.com/2024/01/23/wVzjWqlU.png" alt="Untitled"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本次作业是我第一次接触 AI 博弈，我亲手实现了 UCT 算法，花了大量时间 debug（一旦 UCT 算法中有一个小的逻辑错误，加上各种 trick 调优胜率也很难上 90%），并在反复观察、总结 AI 对局中不断实验优化，体会到剪枝优化与模拟效率间平衡的重要性，在这一过程中收获颇丰，最终测试结果也比较令人满意。再次感谢马老师和助教的指导！</p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://example.com/2024/01/23/ConnectFour/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://example.com/2024/01/23/ConnectFour/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
